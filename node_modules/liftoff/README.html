<p align="center">
  <a href="http://liftoffjs.com">
    <img height="100" width="297" src="https://cdn.rawgit.com/tkellen/js-liftoff/master/artwork/liftoff.svg"/>
  </a>
</p>
<h1>liftoff <a href="http://travis-ci.org/js-cli/js-liftoff"><img src="https://secure.travis-ci.org/js-cli/js-liftoff.svg" alt="Build Status"></a> <a href="https://ci.appveyor.com/project/js-cli/js-liftoff/branch/master"><img src="https://ci.appveyor.com/api/projects/status/5a6w8xuq8ed1ilc4/branch/master?svg=true" alt="Build status"></a></h1>
<blockquote>
<p>Launch your command line tool with ease.</p>
</blockquote>
<p><a href="https://nodei.co/npm/liftoff/"><img src="https://nodei.co/npm/liftoff.png" alt="NPM"></a></p>
<h2>What is it?</h2>
<p><a href="http://weblog.bocoup.com/building-command-line-tools-in-node-with-liftoff/">See this blog post</a>, <a href="https://github.com/js-cli/js-hacker">check out this proof of concept</a>, or read on.</p>
<p>Say you're writing a CLI tool.  Let's call it <a href="https://github.com/js-cli/js-hacker">hacker</a>.  You want to configure it using a <code>Hackerfile</code>.  This is node, so you install <code>hacker</code> locally for each project you use it in.  But, in order to get the <code>hacker</code> command in your PATH, you also install it globally.</p>
<p>Now, when you run <code>hacker</code>, you want to configure what it does using the <code>Hackerfile</code> in your current directory, and you want it to execute using the local installation of your tool.  Also, it'd be nice if the <code>hacker</code> command was smart enough to traverse up your folders until it finds a <code>Hackerfile</code>â€”for those times when you're not in the root directory of your project.  Heck, you might even want to launch <code>hacker</code> from a folder outside of your project by manually specifying a working directory.  Liftoff manages this for you.</p>
<p>So, everything is working great.  Now you can find your local <code>hacker</code> and <code>Hackerfile</code> with ease.  Unfortunately, it turns out you've authored your <code>Hackerfile</code> in coffee-script, or some other JS variant.  In order to support <em>that</em>, you have to load the compiler for it, and then register the extension for it with node.  Good news, Liftoff can do that, and a whole lot more, too.</p>
<h2>API</h2>
<h3>constructor(opts)</h3>
<p>Create an instance of Liftoff to invoke your application.</p>
<p>An example utilizing all options:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> Hacker = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">processTitle</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">moduleName</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">configName</span>: <span class="hljs-string">'hackerfile'</span>,
  <span class="hljs-attr">extensions</span>: {
    <span class="hljs-string">'.js'</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-string">'.json'</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-string">'.coffee'</span>: <span class="hljs-string">'coffee-script/register'</span>
  },
  <span class="hljs-attr">v8flags</span>: [<span class="hljs-string">'--harmony'</span>] <span class="hljs-comment">// or v8flags: require('v8flags')</span>
});
</code></pre>
<h4>opts.name</h4>
<p>Sugar for setting <code>processTitle</code>, <code>moduleName</code>, <code>configName</code> automatically.</p>
<p>Type: <code>String</code><br>
Default: <code>null</code></p>
<p>These are equivalent:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> Hacker = Liftoff({
  <span class="hljs-attr">processTitle</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">moduleName</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">configName</span>: <span class="hljs-string">'hackerfile'</span>
});
</code></pre>
<pre><code class="language-js"><span class="hljs-keyword">const</span> Hacker = Liftoff({<span class="hljs-attr">name</span>:<span class="hljs-string">'hacker'</span>});
</code></pre>
<h4>opts.moduleName</h4>
<p>Sets which module your application expects to find locally when being run.</p>
<p>Type: <code>String</code><br>
Default: <code>null</code></p>
<h4>opts.configName</h4>
<p>Sets the name of the configuration file Liftoff will attempt to find.  Case-insensitive.</p>
<p>Type: <code>String</code><br>
Default: <code>null</code></p>
<h4>opts.extensions</h4>
<p>Set extensions to include when searching for a configuration file.  If an external module is needed to load a given extension (e.g. <code>.coffee</code>), the module name should be specified as the value for the key.</p>
<p>Type: <code>Object</code><br>
Default: <code>{&quot;.js&quot;:null,&quot;.json&quot;:null}</code></p>
<p><strong>Examples:</strong></p>
<p>In this example Liftoff will look for <code>myappfile{.js,.json,.coffee}</code>.  If a config with the extension <code>.coffee</code> is found, Liftoff will try to require <code>coffee-script/require</code> from the current working directory.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'myapp'</span>,
  <span class="hljs-attr">extensions</span>: {
    <span class="hljs-string">'.js'</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-string">'.json'</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-string">'.coffee'</span>: <span class="hljs-string">'coffee-script/register'</span>
  }
});
</code></pre>
<p>In this example, Liftoff will look for <code>.myapp{rc}</code>.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'myapp'</span>,
  <span class="hljs-attr">configName</span>: <span class="hljs-string">'.myapp'</span>,
  <span class="hljs-attr">extensions</span>: {
    <span class="hljs-string">'rc'</span>: <span class="hljs-literal">null</span>
  }
});
</code></pre>
<p>In this example, Liftoff will automatically attempt to load the correct module for any javascript variant supported by <a href="https://github.com/tkellen/node-interpret">node-interpret</a> (as long as it does not require a register method).</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'myapp'</span>,
  <span class="hljs-attr">extensions</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'interpret'</span>).jsVariants
});
</code></pre>
<h4>opts.v8flags</h4>
<p>Any flag specified here will be applied to node, not your program.  Useful for supporting invocations like <code>myapp --harmony command</code>, where <code>--harmony</code> should be passed to node, not your program. This functionality is implemented using <a href="http://github.com/tkellen/node-flagged-respawn">flagged-respawn</a>. To support all v8flags, see <a href="https://github.com/tkellen/node-v8flags">node-v8flags</a>.</p>
<p>Type: <code>Array|Function</code><br>
Default: <code>null</code></p>
<p>If this method is a function, it should take a node-style callback that yields an array of flags.</p>
<h4>opts.processTitle</h4>
<p>Sets what the <a href="http://nodejs.org/api/process.html#process_process_title">process title</a> will be.</p>
<p>Type: <code>String</code><br>
Default: <code>null</code></p>
<h4>opts.completions(type)</h4>
<p>A method to handle bash/zsh/whatever completions.</p>
<p>Type: <code>Function</code><br>
Default: <code>null</code></p>
<h4>opts.configFiles</h4>
<p>An object of configuration files to find. Each property is keyed by the default basename of the file being found, and the value is an object of <a href="#path-arguments">path arguments</a> keyed by unique names.</p>
<p><strong>Note:</strong> This option is useful if, for example, you want to support an <code>.apprc</code> file in addition to an <code>appfile.js</code>. If you only need a single configuration file, you probably don't need this. In addition to letting you find multiple files, this option allows more fine-grained control over how configuration files are located.</p>
<p>Type: <code>Object</code><br>
Default: <code>null</code></p>
<h4>Path arguments</h4>
<p>The <a href="https://github.com/js-cli/fined"><code>fined</code></a> module accepts a string representing the path to search or an object with the following keys:</p>
<ul>
<li>
<p><code>path</code> <strong>(required)</strong></p>
<p>The path to search. Using only a string expands to this property.</p>
<p>Type: <code>String</code><br>
Default: <code>null</code></p>
</li>
<li>
<p><code>name</code></p>
<p>The basename of the file to find. Extensions are appended during lookup.</p>
<p>Type: <code>String</code><br>
Default: Top-level key in <code>configFiles</code></p>
</li>
<li>
<p><code>extensions</code></p>
<p>The extensions to append to <code>name</code> during lookup. See also: <a href="#optsextensions"><code>opts.extensions</code></a>.</p>
<p>Type: <code>String|Array|Object</code><br>
Default: The value of <a href="#optsextensions"><code>opts.extensions</code></a></p>
</li>
<li>
<p><code>cwd</code></p>
<p>The base directory of <code>path</code> (if relative).</p>
<p>Type: <code>String</code><br>
Default: The value of <a href="#optscwd"><code>opts.cwd</code></a></p>
</li>
<li>
<p><code>findUp</code></p>
<p>Whether the <code>path</code> should be traversed up to find the file.</p>
<p>Type: <code>Boolean</code><br>
Default: <code>false</code></p>
</li>
</ul>
<p><strong>Examples:</strong></p>
<p>In this example Liftoff will look for the <code>.hacker.js</code> file relative to the <code>cwd</code> as declared in <code>configFiles</code>.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">configFiles</span>: {
    <span class="hljs-string">'.hacker'</span>: {
      <span class="hljs-attr">cwd</span>: <span class="hljs-string">'.'</span>
    }
  }
});
</code></pre>
<p>In this example, Liftoff will look for <code>.hackerrc</code> in the home directory.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">configFiles</span>: {
    <span class="hljs-string">'.hacker'</span>: {
      <span class="hljs-attr">home</span>: {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'~'</span>,
        <span class="hljs-attr">extensions</span>: {
          <span class="hljs-string">'rc'</span>: <span class="hljs-literal">null</span>
        }
      }
    }
  }
});
</code></pre>
<p>In this example, Liftoff will look in the <code>cwd</code> and then lookup the tree for the <code>.hacker.js</code> file.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">configFiles</span>: {
    <span class="hljs-string">'.hacker'</span>: {
      <span class="hljs-attr">up</span>: {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'.'</span>,
        <span class="hljs-attr">findUp</span>: <span class="hljs-literal">true</span>
      }
    }
  }
});
</code></pre>
<p>In this example, the <code>name</code> is overridden and the key is ignored so Liftoff looks for <code>.override.js</code>.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">configFiles</span>: {
    <span class="hljs-attr">hacker</span>: {
      <span class="hljs-attr">override</span>: {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'.'</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'.override'</span>
      }
    }
  }
});
</code></pre>
<p>In this example, Liftoff will use the home directory as the <code>cwd</code> and looks for <code>~/.hacker.js</code>.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">configFiles</span>: {
    <span class="hljs-string">'.hacker'</span>: {
      <span class="hljs-attr">home</span>: {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'.'</span>,
        <span class="hljs-attr">cwd</span>: <span class="hljs-string">'~'</span>
      }
    }
  }
});
</code></pre>
<h2>launch(opts, callback(env))</h2>
<p>Launches your application with provided options, builds an environment, and invokes your callback, passing the calculated environment as the first argument.</p>
<h5>Example Configuration w/ Options Parsing:</h5>
<pre><code class="language-js"><span class="hljs-keyword">const</span> Liftoff = <span class="hljs-built_in">require</span>(<span class="hljs-string">'liftoff'</span>);
<span class="hljs-keyword">const</span> MyApp = <span class="hljs-keyword">new</span> Liftoff({<span class="hljs-attr">name</span>:<span class="hljs-string">'myapp'</span>});
<span class="hljs-keyword">const</span> argv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'minimist'</span>)(process.argv.slice(<span class="hljs-number">2</span>));
<span class="hljs-keyword">const</span> invoke = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">env</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'my environment is:'</span>, env);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'my cli options are:'</span>, argv);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'my liftoff config is:'</span>, <span class="hljs-keyword">this</span>);
};
MyApp.launch({
  <span class="hljs-attr">cwd</span>: argv.cwd,
  <span class="hljs-attr">configPath</span>: argv.myappfile,
  <span class="hljs-attr">require</span>: argv.require,
  <span class="hljs-attr">completion</span>: argv.completion
}, invoke);
</code></pre>
<h4>opts.cwd</h4>
<p>Change the current working directory for this launch. Relative paths are calculated against <code>process.cwd()</code>.</p>
<p>Type: <code>String</code><br>
Default: <code>process.cwd()</code></p>
<p><strong>Example Configuration:</strong></p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> argv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'minimist'</span>)(process.argv.slice(<span class="hljs-number">2</span>));
MyApp.launch({
  <span class="hljs-attr">cwd</span>: argv.cwd
}, invoke);
</code></pre>
<p><strong>Matching CLI Invocation:</strong></p>
<pre><code>myapp --cwd ../
</code></pre>
<h4>opts.configPath</h4>
<p>Don't search for a config, use the one provided. <strong>Note:</strong> Liftoff will assume the current working directory is the directory containing the config file unless an alternate location is explicitly specified using <code>cwd</code>.</p>
<p>Type: <code>String</code><br>
Default: <code>null</code></p>
<p><strong>Example Configuration:</strong></p>
<pre><code class="language-js"><span class="hljs-keyword">var</span> argv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'minimist'</span>)(process.argv.slice(<span class="hljs-number">2</span>));
MyApp.launch({
  <span class="hljs-attr">configPath</span>: argv.myappfile
}, invoke);
</code></pre>
<p><strong>Matching CLI Invocation:</strong></p>
<pre><code>myapp --myappfile /var/www/project/Myappfile.js
</code></pre>
<p><strong>Examples using <code>cwd</code> and <code>configPath</code> together:</strong></p>
<p>These are functionally identical:</p>
<pre><code>myapp --myappfile /var/www/project/Myappfile.js
myapp --cwd /var/www/project
</code></pre>
<p>These can run myapp from a shared directory as though it were located in another project:</p>
<pre><code>myapp --myappfile /Users/name/Myappfile.js --cwd /var/www/project1
myapp --myappfile /Users/name/Myappfile.js --cwd /var/www/project2
</code></pre>
<h4>opts.require</h4>
<p>A string or array of modules to attempt requiring from the local working directory before invoking the launch callback.</p>
<p>Type: <code>String|Array</code><br>
Default: <code>null</code></p>
<p><strong>Example Configuration:</strong></p>
<pre><code class="language-js"><span class="hljs-keyword">var</span> argv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'minimist'</span>)(process.argv.slice(<span class="hljs-number">2</span>));
MyApp.launch({
  <span class="hljs-attr">require</span>: argv.require
}, invoke);
</code></pre>
<p><strong>Matching CLI Invocation:</strong></p>
<pre><code class="language-js">myapp --<span class="hljs-built_in">require</span> coffee-script/register
</code></pre>
<h4>callback(env)</h4>
<p>A function to start your application.  When invoked, <code>this</code> will be your instance of Liftoff. The <code>env</code> param will contain the following keys:</p>
<ul>
<li><code>cwd</code>: the current working directory</li>
<li><code>require</code>: an array of modules that liftoff tried to pre-load</li>
<li><code>configNameSearch</code>: the config files searched for</li>
<li><code>configPath</code>: the full path to your configuration file (if found)</li>
<li><code>configBase</code>: the base directory of your configuration file (if found)</li>
<li><code>modulePath</code>: the full path to the local module your project relies on (if found)</li>
<li><code>modulePackage</code>: the contents of the local module's package.json (if found)</li>
<li><code>configFiles</code>: an object of filepaths for each found config file (filepath values will be null if not found)</li>
</ul>
<h3>events</h3>
<h4>require(name, module)</h4>
<p>Emitted when a module is pre-loaded.</p>
<pre><code class="language-js"><span class="hljs-keyword">var</span> Hacker = <span class="hljs-keyword">new</span> Liftoff({<span class="hljs-attr">name</span>:<span class="hljs-string">'hacker'</span>});
Hacker.on(<span class="hljs-string">'require'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, module</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Requiring external module: '</span>+name+<span class="hljs-string">'...'</span>);
  <span class="hljs-comment">// automatically register coffee-script extensions</span>
  <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'coffee-script'</span>) {
    <span class="hljs-built_in">module</span>.register();
  }
});
</code></pre>
<h4>requireFail(name, err)</h4>
<p>Emitted when a requested module cannot be preloaded.</p>
<pre><code class="language-js"><span class="hljs-keyword">var</span> Hacker = <span class="hljs-keyword">new</span> Liftoff({<span class="hljs-attr">name</span>:<span class="hljs-string">'hacker'</span>});
Hacker.on(<span class="hljs-string">'requireFail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, err</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Unable to load:'</span>, name, err);
});
</code></pre>
<h4>respawn(flags, child)</h4>
<p>Emitted when Liftoff re-spawns your process (when a <a href="#optsv8flags"><code>v8flags</code></a> is detected).</p>
<pre><code class="language-js"><span class="hljs-keyword">var</span> Hacker = <span class="hljs-keyword">new</span> Liftoff({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'hacker'</span>,
  <span class="hljs-attr">v8flags</span>: [<span class="hljs-string">'--harmony'</span>]
});
Hacker.on(<span class="hljs-string">'respawn'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">flags, child</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Detected node flags:'</span>, flags);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Respawned to PID:'</span>, child.pid);
});
</code></pre>
<p>Event will be triggered for this command:
<code>hacker --harmony commmand</code></p>
<h2>Examples</h2>
<p>Check out how <a href="https://github.com/gulpjs/gulp/blob/master/bin/gulp.js">gulp</a> uses Liftoff.</p>
<p>For a bare-bones example, try <a href="https://github.com/js-cli/js-hacker/blob/master/bin/hacker.js">the hacker project</a>.</p>
<p>To try the example, do the following:</p>
<ol>
<li>Install the sample project <code>hacker</code> with <code>npm install -g hacker</code>.</li>
<li>Make a <code>Hackerfile.js</code> with some arbitrary javascript it.</li>
<li>Install hacker next to it with <code>npm install hacker</code>.</li>
<li>Run <code>hacker</code> while in the same parent folder.</li>
</ol>
